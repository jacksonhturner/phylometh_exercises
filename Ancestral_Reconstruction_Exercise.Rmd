---
title: "EEB 587 Week 6 Exercise"
author: "Jackson Turner"
date: "3/11/2022"
output:
  html_document: 
  pdf_document: default
---

More verbose and complete version coming soon; this is a placeholder that will be continuously updated. 

Load our packages.

```{r, evaluate=TRUE}
library(ape)
library(geiger)
library(phangorn)
library(corHMM)

```
Load and format our data.
```{r, evaluate=TRUE}
tree <- read.tree("RAxML_bestTree.T2.tre")
plot.phylo(tree) #plot the tree if you want

discrete.data <- (read.csv(file="Co1_states.csv", stringsAsFactors=FALSE)) #read the csv file

#all states are 0 = absent & 1 = present
#barbs = if tailpipes have barbs 
#meringo = if dorsal coronae protrude to sides, paddles long and skinny
#rgroup = if heads and postspiracular process are black and larva is bulky
#tailpipe_fused = if tailpipe is connected to the postspiracular sclerite
#unknown_to_me = if i've never seen or worked with the larva in person

rownames(discrete.data) <- discrete.data[,1] #formatting the data
discrete.data<-discrete.data[,-1]
```
Visualize our data to validate that it's not weird and format it some more for the ancestral reconstruction models.
```{r, evaluate=TRUE}
cleaned.discrete<-treedata(tree,data=discrete.data,sort=TRUE)# using the treedata() function to quality check it
(visualize_data<-cleaned.discrete) #look at it; it looks fine

discrete.phyDat <- phangorn::phyDat((cleaned.discrete$data), type="USER",levels=c(0,1)) #formatting for functions later
```
Run our ancestral reconstruction model using parsimony.
```{r, evaluate=TRUE}
anc.p <- phangorn::ancestral.pars(tree, discrete.phyDat[,1]) #using parsimony for ancestral reconstruction
plotAnc(tree, anc.p, 1) #behold
```
There's no uncertainty, which is variation in the probability that a given node has a certain trait. This is because parsimony produces reconstructions that require the same amount of changes no matter how many trees you make (are equally parsimonious). (Losos, 1999)
```{r, evaluate=TRUE}
anc.ml <- ancestral.pml(pml(tree, discrete.phyDat), type="ml") #using maximum likelihood for ancestral reconstruction
plotAnc(tree, anc.ml, 1) #pretty much the same but with more uncertainty
```
There is uncertainty in the maximum likelihood model doesn't minimize the number of changes, but instead uses the data to determine the most likely tree, leading to uncertainty.

Questions 1-4 coming soon!